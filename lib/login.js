"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_elementsNitrogenLoginElement=require("./elements/nitrogen-login-element"),_elementsNitrogenLoginElement2=_interopRequireDefault(_elementsNitrogenLoginElement),_atom=require("atom"),_emitter=require("./emitter"),_emitter2=_interopRequireDefault(_emitter),_jquery=require("jquery"),_jquery2=_interopRequireDefault(_jquery),_actionsSnackbarActions=require("./actions/snackbar-actions"),_actionsSnackbarActions2=_interopRequireDefault(_actionsSnackbarActions),_storesTokenStore=require("./stores/token-store"),_storesTokenStore2=_interopRequireDefault(_storesTokenStore),Login=function(){function e(){var t=this;_classCallCheck(this,e),this.subscriptions=null,this.modalPanel=null,this.handleModalPanelDidChangeVisible=function(e){e?((0,_jquery2["default"])("body").on("click.nitrogen-login",function(e){return 0===(0,_jquery2["default"])(e.target).closest("nitrogen-login").length?void t.hide():void 0}).on("keydown.nitrogen-login",function(e){27===e.keyCode&&t.hide()}),t.loginEl.component.focusLogin()):(0,_jquery2["default"])("body").off("click.nitrogen-login").off("keydown.nitrogen-login")},this.tokenStoreDidChange=function(){_storesTokenStore2["default"].token&&(_actionsSnackbarActions2["default"].post("You have successfully logged in to Nitrous."),t.hide())},this.show=function(){t.modalPanel.show()},this.hide=function(){t.modalPanel.hide()}}return _createClass(e,[{key:"activate",value:function(){var e=this;this.subscriptions=new _atom.CompositeDisposable,this.loginEl=new _elementsNitrogenLoginElement2["default"],this.subscriptions.add(atom.commands.add("atom-workspace",{"nitrogen:show-login-dialog":function(){e.show()}})),this.modalPanel=atom.workspace.addModalPanel({item:this.loginEl,visible:!1}),this.subscriptions.add(this.modalPanel.onDidChangeVisible(this.handleModalPanelDidChangeVisible)),_emitter2["default"].on("hide-login-dialog",this.hide),_storesTokenStore2["default"].onChange(this.tokenStoreDidChange)}},{key:"deactivate",value:function(){_storesTokenStore2["default"].offChange(this.tokenStoreDidChange),_emitter2["default"].off("hide-login-dialog",this.hide),this.loginEl.destroy(),this.subscriptions.dispose()}}]),e}();exports["default"]=new Login,module.exports=exports["default"];