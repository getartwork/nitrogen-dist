"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_get=function(t,e,n){for(var i=!0;i;){var r=t,s=e,o=n;i=!1,null===r&&(r=Function.prototype);var a=Object.getOwnPropertyDescriptor(r,s);if(void 0!==a){if("value"in a)return a.value;var c=a.get;if(void 0===c)return;return c.call(o)}var u=Object.getPrototypeOf(r);if(null===u)return;t=u,e=s,n=o,i=!0,a=u=void 0}},Store=require("./store"),immutable=require("immutable"),Setting=require("../records/setting"),iwc=require("../../util/iwc"),Map=immutable.Map,SettingStore=function(t){function e(){var t=this;_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this),iwc.on("nsync-setting-store.get-settings",function(){iwc.send("nsync-setting-store.settings",t._settings.toJS())}),this.load()}return _inherits(e,t),_createClass(e,[{key:"reset",value:function(){this._settings=Map(),this._loaded=!1}},{key:"notifyChange",value:function(){_get(Object.getPrototypeOf(e.prototype),"notifyChange",this).call(this),iwc.send("nsync-setting-store.settings",this._settings.toJS())}},{key:"updateSetting",value:function(t,e,n){var i=this.getSetting(t);this._settings=this._settings.set(t,i.set(e,n)),this.notifyChange(),this.save()}},{key:"getSetting",value:function(t){if(t){var e=this._settings.get(t);return e||(e=new Setting,this._settings=this._settings.set(t,e)),e}}},{key:"isAnyContainerSyncing",value:function(){return!!this._settings.find(function(t){return"syncing"===t.syncState||"starting"===t.syncState})}},{key:"save",value:function(){localStorage.setItem("nsync:setting-store",JSON.stringify(this._settings.toJS()))}},{key:"load",value:function(){this._loaded=!0;var t=void 0;try{t=JSON.parse(localStorage.getItem("nsync:setting-store"))}catch(e){return void localStorage.removeItem("nsync:setting-store")}if(t){var n={};for(var i in t){var r=t[i];["starting","running","syncing"].includes(r.syncState)?r.syncState="running":r.syncState="stopped",n[i]=Setting.deserialize(r)}this._settings=Map(n),this.notifyChange()}}},{key:"settings",get:function(){return this._settings}},{key:"loaded",get:function(){return this._loaded}}]),e}(Store);module.exports=new SettingStore;