"use strict";module.exports=function(e,r){function n(){var r=require("./resources");r.assetPath=a.join(a.dirname(e),"..","..","resources");var n=require("./tray-menu"),o=require("./stores/token-store"),s=require("./stores/container-store"),u=require("./stores/setting-store"),l=require("./nsync"),d=t.require("dialog");window.NsyncApp={trayMenu:n,nsync:l},c.on("nsync-runner.start-server",function(e,r,n){o.updateToken(r),l.run(e,n)});var y=function(){l.kill(),o.reset(),s.reset(),u.reset(),n.render()};c.on("nsync-runner.kill-server",function(){y()}),i.on("request-quit",function(){var e=d.showMessageBox({type:"question",buttons:["Quit","Don't Quit"],title:"Quit Nitrogen?",message:"Are you sure you want to quit Nitrogen?",detail:"Any unsaved changes will be lost."});0===e&&(y(),i.exit(0))}),c.setEnv("NSYNC_RUNNER_READY",!0),c.send("nsync-runner.ready")}var t=require("remote"),i=t.require("app"),o=t.require("browser-window"),s=t.getCurrentWindow();if(o.getAllWindows().find(function(e){return e.id!==s.id&&"atom://nitrogen/lib/nsync/nsync-runner.html"===e.getUrl()}))return void s.close();window.addEventListener("beforeunload",function(e){s.hide(),e.returnValue=!1},!1),window.addEventListener("keydown",function(e){var r="darwin"===process.platform;87===e.keyCode&&(r&&e.metaKey||!r&&e.ctrlKey)&&s.hide(),73===e.keyCode&&e.altKey&&(r&&e.metaKey||!r&&e.ctrlKey)&&s.inspectElement(0,0)},!1),require.main.filename=e,require.main.paths.push(r),require("babel-polyfill");var u=require("./logger");document.getElementById("nsync-log-scrollback-field").addEventListener("change",function(e){var r=parseInt(e.currentTarget.value,10);isNaN(r)&&(r=500),u.setScrollback(r),e.currentTarget.value=r},!1);var a=require("path"),l=require("lockfile"),c=require("../util/iwc"),d=t.getGlobal("process"),y=new Date(+new Date-1e3*d.uptime()).toISOString().slice(0,10),g="nitrogen-"+y+"-"+d.pid+".lock",q=a.join(i.getPath("temp"),g);l.lock(q,function(e){return e?void s.close():void n()})};