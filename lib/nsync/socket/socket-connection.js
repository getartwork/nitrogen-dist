"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();module.exports=function(){function e(t,n){_classCallCheck(this,e),this.url=t,this._protocols=n,this._retries=0,this.shouldRetry=!0,this.heartbeatTimeout=3e4,this._ws=null,this._retryTimeout=null,this._heartbeatTimer=null}return _createClass(e,[{key:"open",value:function(e){var t=this;if(this._ws&&this.close(),e||this.onbeforeopen(),!this.url)return void(this._ws=null);this._heartbeat();var n=void 0;n=this._protocols?new WebSocket(this.url,this._protocols):new WebSocket(this.url),this._ws=n,n.onopen=function(e){return t.onopen(e)},n.onclose=function(e){return t.onclose(e)},n.onerror=function(e){return t.onerror(e)},n.onmessage=function(e){"h"===e.data&&t._heartbeat(),t.onmessage(e)},n._onopen=function(){t._retries=0,t._heartbeat()},n._onclose=function(){n.removeEventListener("open",n._onopen,!1),n.removeEventListener("close",n._onclose,!1),window.clearInterval(t._heartbeatTimer),t._heartbeatTimer=null,t.shouldRetry&&!n._noRetry&&t.retry()},n.addEventListener("open",n._onopen,!1),n.addEventListener("close",n._onclose,!1)}},{key:"_heartbeat",value:function(){var e=this;window.clearInterval(this._heartbeatTimer),this._heartbeatTimer=window.setInterval(function(){e.close(!0)},this.heartbeatTimeout),this.send("h")}},{key:"retry",value:function(){var e=this,t=0;this._retries<=5?t=2e3:this._retries<=10?t=3e3:this._retries>10&&(t=5e3),window.clearTimeout(this._retryTimeout),this._retryTimeout=window.setTimeout(function(){e.open()},t),this._retries+=1}},{key:"send",value:function(e){try{this._ws&&this.readyState===WebSocket.OPEN&&this._ws.send(e)}catch(t){}}},{key:"close",value:function(){this._ws&&(this._ws._noRetry=!0,this._ws.close())}},{key:"onbeforeopen",value:function(){}},{key:"onopen",value:function(){}},{key:"onclose",value:function(){}},{key:"onmessage",value:function(){}},{key:"onerror",value:function(){}},{key:"binaryType",get:function(){if(this._ws)return this._ws.binaryType}},{key:"bufferedAmount",get:function(){if(this._ws)return this._ws.bufferedAmount}},{key:"extensions",get:function(){if(this._ws)return this._ws.extensions}},{key:"protocol",get:function(){if(this._ws)return this._ws.protocol}},{key:"readyState",get:function(){if(this._ws)return this._ws.readyState}}]),e}();