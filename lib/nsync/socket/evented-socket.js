"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _inherits(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),_get=function(e,n,t){for(var o=!0;o;){var i=e,r=n,c=t;o=!1,null===i&&(i=Function.prototype);var u=Object.getOwnPropertyDescriptor(i,r);if(void 0!==u){if("value"in u)return u.value;var s=u.get;if(void 0===s)return;return s.call(c)}var l=Object.getPrototypeOf(i);if(null===l)return;e=l,n=r,t=c,o=!0,u=l=void 0}},SocketConnection=require("./socket-connection"),EventEmitter=require("events").EventEmitter;module.exports=function(e){function n(e){var t=this;_classCallCheck(this,n),_get(Object.getPrototypeOf(n.prototype),"constructor",this).call(this),this.url=e,this._connected=!1;var o=this._conn=new SocketConnection;o.onbeforeopen=function(){return t.willOpen()},o.onopen=function(e){return t.didOpen(e)},o.onmessage=function(e){return t.didReceiveMessage(e)},o.onerror=function(e){return t.didFail(e)},o.onclose=function(e){return t.didClose(e)}}return _inherits(n,e),_createClass(n,[{key:"connect",value:function(e){this._conn.url=this.url,this._conn.open(e)}},{key:"disconnect",value:function(){this._conn&&this._conn.close()}},{key:"retry",value:function(){this._conn&&this._conn.retry()}},{key:"dispose",value:function(){this._conn=void 0}},{key:"send",value:function(e){this._conn&&this._conn.send(e)}},{key:"willOpen",value:function(e){this._conn.url=this.url,this.emit("beforeopen",e)}},{key:"didOpen",value:function(e){this._connected=!0,this.emit("open",e)}},{key:"didReceiveMessage",value:function(e){this.emit("message",e.data)}},{key:"didFail",value:function(e){this._connected=!1,this.emit("error",e)}},{key:"didClose",value:function(e){this._connected=!1,this._conn.url=null,this.emit("close",e)}},{key:"connected",get:function(){return this._connected}}]),n}(EventEmitter);