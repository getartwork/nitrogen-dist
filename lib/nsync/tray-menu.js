"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),remote=require("remote"),app=remote.require("app"),Tray=remote.require("tray"),Menu=remote.require("menu"),settingStore=require("./stores/setting-store"),platform=require("../util/platform"),resources=require("./resources"),emitter=require("../emitter"),TrayMenu=function(){function e(){_classCallCheck(this,e),this.settingStoreDidChange=this.settingStoreDidChange.bind(this),this.handleOpenNitrogen=this.handleOpenNitrogen.bind(this),this.handleOpenWindow=this.handleOpenWindow.bind(this),this.handleQuit=this.handleQuit.bind(this),this.showNotification=this.showNotification.bind(this);var t=this._tray=new Tray(resources.trayIcon(!1,!1,!1));t.on("clicked",function(e,i){t.popUpContextMenu({x:Math.floor(i.x+i.width/3),y:Math.floor(i.y+i.height/3)})}),this.render(),settingStore.onChange(this.settingStoreDidChange),emitter.on("show-notification",this.showNotification)}return _createClass(e,[{key:"destroy",value:function(){settingStore.offChange(this.settingStoreDidChange),emitter.off("show-notification",this.showNotification),this._tray.destroy(),this._tray=null}},{key:"render",value:function(){var e=this._tray;if(e){var t=[{label:"Open Nitrogen...",click:this.handleOpenNitrogen},{label:"Open Log Window...",click:this.handleOpenWindow},{type:"separator"},{label:"Quit Nitrogen...",accelerator:platform.isMac?"Command+Q":"Alt+F4",click:this.handleQuit}];e.setContextMenu(Menu.buildFromTemplate(t)),e.setToolTip("Nitrogen");var i=settingStore.isAnyContainerSyncing();e.setImage(resources.trayIcon(!0,!1,i)),e.setPressedImage(resources.trayIcon(!0,!0,i))}}},{key:"settingStoreDidChange",value:function(){this.render()}},{key:"handleOpenNitrogen",value:function(){var e={preventDefault:function(){}};app.emit("open-file",e)}},{key:"handleOpenWindow",value:function(){var e=remote.getCurrentWindow();e.show(),e.setMenu(null),e.setMenuBarVisibility(!1)}},{key:"handleQuit",value:function(){app.quit()}},{key:"showNotification",value:function(e){var t="Nitrogen";platform.isWindows?this._tray.displayBalloon({title:t,content:e}):Notification.requestPermission(function(i){"granted"===i&&new Notification(t,{body:e})})}}]),e}();module.exports=new TrayMenu;