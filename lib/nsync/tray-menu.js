"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),remote=require("electron").remote,Tray=remote.Tray,Menu=remote.Menu,app=remote.app,settingStore=require("./stores/setting-store"),platform=require("../util/platform"),resources=require("./resources"),emitter=require("../emitter"),TrayMenu=function(){function e(){_classCallCheck(this,e),this.settingStoreDidChange=this.settingStoreDidChange.bind(this),this.handleOpenNitrogen=this.handleOpenNitrogen.bind(this),this.handleOpenWindow=this.handleOpenWindow.bind(this),this.handleQuit=this.handleQuit.bind(this),this.showNotification=this.showNotification.bind(this);var t=this._tray=new Tray(resources.trayIcon(!1,!1,!1));t.on("clicked",function(e,n){t.popUpContextMenu({x:Math.floor(n.x+n.width/3),y:Math.floor(n.y+n.height/3)})}),this.render(),settingStore.onChange(this.settingStoreDidChange),emitter.on("show-notification",this.showNotification)}return _createClass(e,[{key:"destroy",value:function(){settingStore.offChange(this.settingStoreDidChange),emitter.off("show-notification",this.showNotification),this._tray.destroy(),this._tray=null}},{key:"render",value:function(){var e=this._tray;if(e){var t=[{label:"Open Nitrogen...",click:this.handleOpenNitrogen},{label:"Open Log Window...",click:this.handleOpenWindow},{type:"separator"},{label:"Quit Nitrogen...",accelerator:platform.isMac?"Command+Q":"Alt+F4",click:this.handleQuit}];e.setContextMenu(Menu.buildFromTemplate(t)),e.setToolTip("Nitrogen");var n=settingStore.isAnyContainerSyncing();e.setImage(resources.trayIcon(!0,!1,n)),e.setPressedImage(resources.trayIcon(!0,!0,n))}}},{key:"settingStoreDidChange",value:function(){this.render()}},{key:"handleOpenNitrogen",value:function(){var e={preventDefault:function(){}};app.emit("open-file",e)}},{key:"handleOpenWindow",value:function(){var e=remote.getCurrentWindow();e.show(),e.setMenu(null),e.setMenuBarVisibility(!1)}},{key:"handleQuit",value:function(){app.quit()}},{key:"showNotification",value:function(e){var t="Nitrogen";platform.isWindows?this._tray.displayBalloon({title:t,content:e}):Notification.requestPermission(function(n){"granted"===n&&new Notification(t,{body:e})})}}]),e}();module.exports=new TrayMenu;