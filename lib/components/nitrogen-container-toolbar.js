"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),_get=function(e,t,n){for(var i=!0;i;){var a=e,r=t,o=n;i=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(o)}var c=Object.getPrototypeOf(a);if(null===c)return;e=c,t=r,n=o,i=!0,s=c=void 0}},_react=require("react"),_react2=_interopRequireDefault(_react),_recordsContainer=require("../records/container"),_recordsContainer2=_interopRequireDefault(_recordsContainer),_uiSwitch=require("./ui-switch"),_uiSwitch2=_interopRequireDefault(_uiSwitch),_nitrogenPreviewMenu=require("./nitrogen-preview-menu"),_nitrogenPreviewMenu2=_interopRequireDefault(_nitrogenPreviewMenu),_nitrogenUsageRemaining=require("./nitrogen-usage-remaining"),_nitrogenUsageRemaining2=_interopRequireDefault(_nitrogenUsageRemaining),_storesSettingStore=require("../stores/setting-store"),_storesSettingStore2=_interopRequireDefault(_storesSettingStore),_constantsSettingConstants=require("../constants/setting-constants"),_constantsSettingConstants2=_interopRequireDefault(_constantsSettingConstants),_utilIwc=require("../util/iwc"),_utilIwc2=_interopRequireDefault(_utilIwc),_emitter=require("../emitter"),_emitter2=_interopRequireDefault(_emitter),_path=require("path"),_path2=_interopRequireDefault(_path),_utilFileUtil=require("../util/file-util"),_utilFileUtil2=_interopRequireDefault(_utilFileUtil),_actionsContainerActions=require("../actions/container-actions"),_actionsContainerActions2=_interopRequireDefault(_actionsContainerActions),_actionsHostActions=require("../actions/host-actions"),_actionsHostActions2=_interopRequireDefault(_actionsHostActions),_config=require("../config"),_config2=_interopRequireDefault(_config),_actionsSnackbarActions=require("../actions/snackbar-actions"),_actionsSnackbarActions2=_interopRequireDefault(_actionsSnackbarActions),NitrogenContainerToolbar=function(e){function t(){var e=this;_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments),this.displayName="NitrogenContainerToolbar",this.state={setting:_storesSettingStore2["default"].getSetting(this.props.selectedContainer.slug)},this.settingStoreDidChange=function(){e.findSetting(e.props.selectedContainer.slug)},this.handleToggleFileSync=function(){_utilIwc2["default"].send("nsync.toggle-file-sync",e.props.selectedContainer.slug)},this.handleToggleTunneling=function(){var t=e.state.setting,n=!t.tunnelingEnabled;_utilIwc2["default"].send("nsync.toggle-tunneling",e.props.selectedContainer.slug),n&&0===t.tunneledPorts.size&&_emitter2["default"].emit("show-container-settings",e.props.selectedContainer.slug,_constantsSettingConstants2["default"].PORTS_FIELD)},this.handleClickOpenProject=function(){var t=e.props.selectedContainer,n=t.host,i=atom.packages.getLoadedPackage("tree-view");if(!i||!i.mainActivated)return void _actionsSnackbarActions2["default"].post("Please enable tree-view package");if(t&&n){var a=_path2["default"].join(_config2["default"].nitrousFolderPath,n.slug,t.slug);try{_utilFileUtil2["default"].mkdirPSync(a,493)}catch(r){}atom.commands.dispatch(atom.views.getView(atom.workspace),"tree-view:toggle-focus"),atom.project.addPath(a)}else _actionsSnackbarActions2["default"].post("Could not fetch your workstation state. Please restart atom if this problem persists.")},this.handleClickShell=function(){_emitter2["default"].emit("show-shell",e.props.selectedContainer.slug)},this.handleClickSettings=function(){_emitter2["default"].emit("show-container-settings",e.props.selectedContainer.slug,_constantsSettingConstants2["default"].PORTS_FIELD)},this.startContainer=function(){_actionsContainerActions2["default"].start(e.props.selectedContainer)},this.startHost=function(){_actionsHostActions2["default"].start(e.state.host)}}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){_storesSettingStore2["default"].onChange(this.settingStoreDidChange),this.findSetting(this.props.selectedContainer.slug)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.selectedContainer,n=e.selectedContainer;t.slug!==n.slug&&this.findSetting(n.slug)}},{key:"componentWillUnmount",value:function(){_storesSettingStore2["default"].offChange(this.settingStoreDidChange)}},{key:"findSetting",value:function(e){this.setState({setting:_storesSettingStore2["default"].getSetting(e)})}},{key:"renderStartButton",value:function(){var e=this.props.selectedContainer,t=e.host,n=void 0,i=void 0;return t&&t.isStopped?(n=this.startHost.bind(this),i="Start Workstation"):(n=this.startContainer.bind(this),i="Start Project"),_react2["default"].createElement("div",{className:"toolbar-segments"},_react2["default"].createElement("div",{className:"toolbar-segment"},_react2["default"].createElement("button",{className:"btn btn-default icon icon-playback-play",onClick:n},i)))}},{key:"renderState",value:function(){var e=this.props.selectedContainer,t=e.host,n=void 0;return n=t&&!t.isRunning?"Workstation is "+t.state+"...":"Project is "+e.state+"...",_react2["default"].createElement("div",{className:"toolbar-segments"},_react2["default"].createElement("div",{className:"toolbar-segment"},_react2["default"].createElement("button",{className:"btn btn-default",disabled:!0},n)))}},{key:"render",value:function(){var e=this.props.selectedContainer,t=this.state.setting,n=e.host,i=e.isStopped||n&&n.isStopped;return _react2["default"].createElement("div",{className:"nitrogen-container-toolbar-component"},t?i?this.renderStartButton():"running"===e.state?_react2["default"].createElement("div",{className:"toolbar-segments"},_react2["default"].createElement("div",{className:"toolbar-segment btn-group"},_react2["default"].createElement("button",{className:"btn btn-default icon icon-file-directory",onClick:this.handleClickOpenProject,disabled:!n},"Open Project"),_react2["default"].createElement("button",{className:"btn btn-default icon icon-terminal",onClick:this.handleClickShell},"Shell"),_react2["default"].createElement(_nitrogenPreviewMenu2["default"],{setting:t}),_react2["default"].createElement("button",{className:"btn btn-default icon icon-gear",onClick:this.handleClickSettings},"Settings")),_react2["default"].createElement("div",{className:"toolbar-segment"},_react2["default"].createElement(_uiSwitch2["default"],{on:t.tunnelingEnabled,onToggle:this.handleToggleTunneling}),_react2["default"].createElement("span",null,"Port Forwarding")),_react2["default"].createElement("div",{className:"toolbar-segment"},_react2["default"].createElement(_uiSwitch2["default"],{on:t.syncEnabled,disabled:t.syncToggling,onToggle:this.handleToggleFileSync,inProgress:t.isSyncing}),_react2["default"].createElement("span",null,"File Sync"))):this.renderState():"",n?_react2["default"].createElement(_nitrogenUsageRemaining2["default"],{host:n}):"")}}],[{key:"propTypes",value:{selectedContainer:_react.PropTypes.instanceOf(_recordsContainer2["default"]).isRequired},enumerable:!0}]),t}(_react2["default"].Component);exports["default"]=NitrogenContainerToolbar,module.exports=exports["default"];